syntax = "proto3";

package consensuscraft;

option go_package = "./gen/pb";

service ConsensusCraftService {
  rpc Stream(stream Message) returns (stream Message);
}

message Message {
  oneof content {
    // Network
    SyncDatabaseRequest sync_database_request = 10;
    SyncDatabaseData sync_database_data = 11;
    SyncDatabaseResponse sync_database_response = 12;
    JoinRequest join_request = 15;
    JoinResponse join_response = 16;

    // Node communication
    ClaimPlayer claim_player = 18;
    UpdateInventory update_inventory = 19;
    ReleasePlayer release_player = 20;
  }
}

message DiscoverNodesRequest {}

message DiscoverNodesResponse { repeated NodeInfo nodes = 1; }

message NodeInfo {
  string endpoint = 1;
  bytes public_key = 2;
}

message SyncDatabaseRequest {}

message SyncDatabaseData {
  bytes key = 1;
  bytes value = 2;
}

message SyncDatabaseResponse {}

message JoinRequest {
  bytes public_key = 1;
  string endpoint = 2;
  bytes signature = 3;
}

message JoinResponse {
  bool accepted = 1;
  repeated string players = 2;
}

message HeartBeat {}

message ClaimPlayer {
  string player = 1;
  bytes signature = 2;
}

message UpdateInventory {
  string player = 1;
  bytes inventory = 2;
  bytes signature = 3;
}

message ReleasePlayer {
  string player = 1;
  bytes signature = 2;
}
